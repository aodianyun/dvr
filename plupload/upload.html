<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no"> 

<title>DVR上传</title>

<link rel="stylesheet" href="http://cdn.aodianyun.com/static/jqueryui/1.8.9/jquery-ui.css" type="text/css" />
<link rel="stylesheet" href="http://cdn.aodianyun.com/static/plupload/js/jquery.simple.ui.plupload/css/jquery.simple.ui.plupload.css" type="text/css" />

<script src="http://cdn.aodianyun.com/static/jquery/jquery-1.9.0.min.js"></script>
<script type="text/javascript" src="http://cdn.aodianyun.com/static/jqueryui/1.10.2/jquery-ui.min.js"></script>

<!-- production -->
<script type="text/javascript" src="http://cdn.aodianyun.com/static/plupload/js/plupload.full.min.js"></script>
<script type="text/javascript" src="http://cdn.aodianyun.com/static/plupload/js/jquery.simple.ui.plupload/jquery.simple.ui.plupload.min.js"></script>
<script type="text/javascript" src="http://cdn.aodianyun.com/static/plupload/js/i18n/zh_CN.js"></script>

</head>
<body style="font: 13px Verdana; background: #eee; color: #333">

<div id="uploader">
    <p>Your browser doesn't have Flash, Silverlight or HTML5 support.</p>
</div>
<br />

<script type="text/javascript">
// Initialize the widget when the DOM is ready
$(function(){
    $("#uploader").plupload({
        // General settings
        runtimes: 'html5,flash,silverlight,html4',
        url: 'upload.php',

        // User can upload no more then 20 files in one go (sets multiple_queues to false)
        max_file_count: 20,
        
        // Part file size
        chunk_size: '10mb',
        
        filters: {
            // Maximum file size
            max_file_size : '4096mb',
            
            // Select the duplicate files are not allowed
            prevent_duplicates : true
        },
        
        //post params
        multipart_params: {
            
        },
        
        // Rename files by clicking on their titles
        rename: false,
        
        // Sort files
        sortable: false,

        // Enable ability to drag'n'drop files onto the widget (currently only HTML5 supports that)
        dragdrop: false,

        // Views to activate
        views: {
            list: true,
            thumbs: false, // Show thumbs
            active: 'list'
        },

        // Flash settings
        flash_swf_url: 'js/Moxie.swf',

        // Silverlight settings
        silverlight_xap_url: 'js/Moxie.xap',
        
        init: {
            FileFiltered: function(uploader,file){
                var ext = ['.avi','.f4v','.mpg','.mp4','.flv','.wmv','.mov','.3gp','.rmvb','.rm','.mkv','.asf','.ts','.mts','.dat','.vob','.mp3','.wav','.m4v','.webm'];
                var type = file['name'].substr(file['name'].lastIndexOf('.')).toLowerCase();
                if(ext.indexOf(type) == -1){
                    $('#uploader').plupload('notify', 'error', "错误：无效的文件扩展名:" + file['name']);
                    uploader.removeFile(file);
                }
            },
            UploadProgress: function(uploader,file){
                $.ERROR(uploader,file);
            },
            QueueChanged: function(uploader,file){
                //$("#queued").val(uploader.total.queued);
            },
            FileUploaded: function(uploader){
                //$("#queued").val(uploader.total.queued);
            }
        }
    });
});

(function($){
    $.extend({
        GET: function(){
            var aQuery = window.location.href.split("?");
            var aGET = new Array();
            if(aQuery.length > 1){
                var aBuf = aQuery[1].split("&");
                for(var i=0, iLoop = aBuf.length; i < iLoop; i++){
                    var aTmp = aBuf[i].split("=");
                    aGET[aTmp[0]] = aTmp[1];
                }
            }
            return aGET;
        },
        ERROR: function(uploader,file){
            $.ajax({
                type:'GET',
                url:'upload2.php',
                data:{action:'error'},
                dataType: 'text',
                async:false,
                success:function(message){
                    if(message){
                        $('#uploader').plupload('notify', 'error', message);
                        uploader.removeFile(file);
                    }
                }
            });
        }
    });
})(jQuery);
</script>
<div><strong>注意</strong>：上传未完成请勿进行关闭或返回操作，否则会造成上传失败！</div>
</body>
</html>